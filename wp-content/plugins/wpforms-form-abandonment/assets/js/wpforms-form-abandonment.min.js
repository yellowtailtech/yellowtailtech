"use strict";var WPFormsFormAbandonment=window.WPFormsFormAbandonment||function(a,t,r){var i,m={},d=!1,s=!1,n=!1,o=!1,f={mobileDetect:null,init:function(){var e;"undefined"!=typeof MobileDetect&&(f.mobileDetect=new MobileDetect(t.navigator.userAgent)),r(a).on("input change",".wpforms-form-abandonment :input",f.prepData),r(a).on("change",".wpforms-form-abandonment input[type=radio]",f.prepData),r(a).on("change",".wpforms-form-abandonment input[type=checkbox]",f.prepData),r(a).on("change",".wpforms-form-abandonment .wpforms-timepicker",f.prepData),r(a).on("mouseleave",this.abandonMouse),r(a).on("mouseenter",this.abandonMouseCancel),f.isMobileDevice()?(f.isIOSDevice()&&r("a").css("cursor","pointer"),e="ontouchstart"in t?"touchstart":"click",r(a).on(e,this.abandonClick),f.addPhoneTabTrigger()):r(a).on("mousedown",this.abandonClick),r(t).on("beforeunload",this.abandonBeforeUnload),r(".wpforms-form").on("wpformsBeforeFormSubmit",f.unbindAbandonBeforeUnloadOnNormalSubmit),r(".wpforms-form").on("wpformsAjaxSubmitSuccess",f.ajaxSubmitSuccess)},isMobileDevice:function(){return!!f.mobileDetect&&!!f.mobileDetect.mobile()},isIOSDevice:function(){return!!f.mobileDetect&&"iOS"===f.mobileDetect.os()},prepData:function(e){e=r(e.target).closest(".wpforms-form");i=e.data("formid"),m[i]=e.serializeArray(),d=JSON.stringify(m),f.debug("Preping data")},sendData:function(){var e,n,o;d&&!s&&i&&void 0!==m[i]&&(s=!0,setTimeout(function(){s=!1},1e4),f.debug("Sending"),e=r(a),WPFormsUtils.triggerEvent(e,"wpformsFormAbandonmentGetFormDataBefore",[i]).isDefaultPrevented()||((n=new FormData).append("action","wpforms_form_abandonment"),n.append("forms",d),n.append("page_url",wpforms_form_abandonment.page_url),n.append("page_title",wpforms_form_abandonment.page_title),n.append("page_id",wpforms_form_abandonment.page_id),("function"==typeof t.navigator.sendBeacon&&!0===t.navigator.sendBeacon(wpforms_form_abandonment.ajaxurl,n)||((o=new XMLHttpRequest).open("POST",wpforms_form_abandonment.ajaxurl,!0),o.send(n),200===o.status))&&e.trigger("wpformsFormAbandonmentDataSent",n),d=!(m={})))},addPhoneTabTrigger:function(){a.addEventListener("visibilitychange",()=>{"visible"!==a.visibilityState?f.abandonPhoneTab():f.abandonPhoneTabCancel()})},abandonPhoneTab:function(e){n=setTimeout(function(){f.debug("Phone abandoned"),f.sendData()},wpforms_form_abandonment.phone_tabbed_timeout)},abandonPhoneTabCancel:function(){n&&clearTimeout(n)},abandonMouse:function(e){e.offsetX<-1||20<e.clientY||(o=setTimeout(function(){f.debug("Mouse abandoned"),f.sendData()},wpforms_form_abandonment.mouse_leave_timeout))},abandonMouseCancel:function(){o&&clearTimeout(o)},abandonClick:function(e){for(var n,o,a=e.srcElement||e.target;a&&(void 0===a.tagName||"a"!==a.tagName.toLowerCase()||!a.href);)a=a.parentNode;a&&a.href&&(f.debug("Click abandoned"),n=a.href,o="internal","mailto"===a.protocol?o="mailto":-1===n.indexOf(wpforms_form_abandonment.home_url)&&(o="external"),["external","internal"].indexOf(o)<0||n.match(/^javascript\:/i)||(o=!(!a.target||a.target.match(/^_(self|parent|top)$/i))&&a.target,((o=e.ctrlKey||e.shiftKey||e.metaKey||2===e.which?"_blank":o)||f.isIOSDevice())&&f.sendData()))},abandonBeforeUnload:function(e){f.debug("Before unload abandoned"),f.sendData()},unbindAbandonBeforeUnloadOnNormalSubmit:function(e){e=r(e.target);e.length<=0||e.first().hasClass("wpforms-ajax-form")||(f.debug("Unbinding abandonBeforeUnload"),r(t).off("beforeunload",this.abandonBeforeUnload))},ajaxSubmitSuccess:function(){f.debug("Ajax submit success event");var e=r(this).data("formid");delete m[e],i=void 0,d=JSON.stringify(m)},debug:function(e){t.location.hash&&"#wpformsfadebug"===t.location.hash&&console.log("WPForms FA: "+e)}};return f}(document,window,jQuery);WPFormsFormAbandonment.init();